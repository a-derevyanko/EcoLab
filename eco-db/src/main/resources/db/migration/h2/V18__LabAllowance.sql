
CREATE table user_defence_allowance  (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY ( START WITH 0) PRIMARY KEY,
  version         INT,
  user_id BIGINT NOT NULL REFERENCES users (id) ON DELETE CASCADE,
  lab_number INT          NOT NULL CHECK (lab_number in (1, 2, 3)),
  /**
  *Блок ключей
  */
  CONSTRAINT fk_user_defence_allowance UNIQUE (user_id, lab_number)
);

CREATE INDEX ix_user_defence_allowance
  ON user_defence_allowance (user_id);

COMMENT ON TABLE user_defence_allowance IS 'Допуск студентов к защитам';
COMMENT ON COLUMN user_defence_allowance.version IS 'Версия изменений(контроль одновременного доступа)';
COMMENT ON COLUMN user_defence_allowance.user_id IS 'Идентификатор пользователя';
COMMENT ON COLUMN user_defence_allowance.lab_number IS 'Номер лабораторной';